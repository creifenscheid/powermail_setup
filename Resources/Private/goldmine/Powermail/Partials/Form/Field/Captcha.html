{namespace vh=In2code\Powermail\ViewHelpers}

<div class="powermail_field">
	<f:comment>
		<!-- Ensure that the captcha field is always required -->
	</f:comment>
	<f:variable name="fieldConfiguration" value="{t:array(array:fieldConfiguration,key:'required',value:'true')}" />

	<f:comment>
		<!-- LABEL -->
	</f:comment>
	<f:render partial="Form/FieldLabel" arguments="{fieldId:fieldConfiguration.id,label:fieldConfiguration.label,hideLabel:fieldConfiguration.hideLabel,required:fieldConfiguration.required}" />

	<f:form.textfield
		id="powermail_field_{fieldConfiguration.id}"
		property="{fieldConfiguration.id}"
		value=""
		class="powermail_element powermail_captcha{f:if(condition:fieldConfiguration.error, then: ' powermail_field_error')}"
		additionalAttributes="{t:form.validationDataAttribute(configuration:fieldConfiguration)}"
	/>

	<f:if condition="{fieldConfiguration.origin}">
		<f:then>
			<f:comment>
				<!--
					if a proper powermail field object is given, use the powermail viewhelper straight forward
				-->
			</f:comment>
			<vh:Validation.Captcha field="{fieldConfiguration.origin}" alt="captcha" class="powermail_captchaimage" id="powermail_captchaimage" />
		</f:then>
		<f:else>
			<f:comment>
				<!--
					format.raw is needed because,
					the t:form.captcha returns the rendered markup of the captcha image,
					which is generated by vh:Validation.captcha
				-->
			</f:comment>
			<f:format.raw><t:form.captcha configuration='{fieldConfiguration}' alt="captcha" class="powermail_captchaimage" id="powermail_captchaimage" /></f:format.raw>
		</f:else>
	</f:if>

	<f:comment>
		<!-- ERROR -->
	</f:comment>
	<f:if condition="{fieldConfiguration.error}"><f:format.raw>{fieldConfiguration.error}</f:format.raw></f:if>
</div>
